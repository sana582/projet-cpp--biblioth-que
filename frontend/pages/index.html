<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma Biblioth√®que Compl√®te</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .subtitle {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
        }

        .biblio-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .biblio-card {
            flex: 1;
            padding: 15px;
            border: 3px solid #ddd;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .biblio-card:hover {
            border-color: #3498db;
        }

        .biblio-card.selected {
            border-color: #3498db;
            background: #ebf5fb;
        }

        .biblio-card h3 {
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .biblio-card p {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .menu-btn {
            padding: 18px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .menu-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.8em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #3498db;
        }

        .form-box {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: bold;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 12px 30px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            margin-right: 10px;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #229954;
            transform: translateY(-2px);
        }

        .btn-back {
            background: #95a5a6;
        }

        .btn-back:hover {
            background: #7f8c8d;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .livre-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .livre-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s;
        }

        .livre-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.15);
            border-color: #3498db;
        }

        .livre-card h3 {
            color: #3498db;
            margin-bottom: 12px;
        }

        .livre-info {
            color: #555;
            margin: 6px 0;
            font-size: 0.95em;
        }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin-top: 10px;
        }

        .libre {
            background: #d4edda;
            color: #155724;
        }

        .emprunte {
            background: #f8d7da;
            color: #721c24;
        }

        .prete {
            background: #fff3cd;
            color: #856404;
        }

        .message {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message.show {
            display: block;
            animation: slideDown 0.3s;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            margin-top: 5px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background: #f8f9fa;
            color: #2c3e50;
            font-weight: bold;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: #ecf0f1;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tab-btn.active {
            background: #3498db;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Syst√®me de Gestion de Biblioth√®ques</h1>
        <p class="subtitle">Gestion compl√®te avec 2 biblioth√®ques</p>

        <div id="message" class="message"></div>

        <!-- S√©lecteur de Biblioth√®que -->
        <div class="biblio-selector">
            <div class="biblio-card selected" onclick="selectionnerBiblio(1)">
                <h3>üèõÔ∏è Biblioth√®que Centrale</h3>
                <p>Marseille (B001)</p>
                <p style="margin-top: 5px;"><strong id="livres-b1">5</strong> livres</p>
            </div>
            <div class="biblio-card" onclick="selectionnerBiblio(2)">
                <h3>üèõÔ∏è Biblioth√®que Nord</h3>
                <p>Aix-en-Provence (B002)</p>
                <p style="margin-top: 5px;"><strong id="livres-b2">0</strong> livres</p>
            </div>
        </div>

        <!-- Menu Principal -->
        <div id="menu-principal" class="section active">
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalLivres">5</div>
                    <div class="stat-label">Total Livres</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="livresLibres">5</div>
                    <div class="stat-label">Disponibles</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="livresEmpruntes">0</div>
                    <div class="stat-label">Emprunt√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="livresPretes">0</div>
                    <div class="stat-label">Pr√™t√©s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalAdherents">1</div>
                    <div class="stat-label">Adh√©rents</div>
                </div>
            </div>

            <div class="menu">
                <button class="menu-btn" onclick="montrerSection('voir-livres')">
                    üìñ Voir les Livres
                </button>
                <button class="menu-btn" onclick="montrerSection('ajouter')">
                    ‚ûï Ajouter Livre
                </button>
                <button class="menu-btn" onclick="montrerSection('emprunter')">
                    üì§ Emprunter
                </button>
                <button class="menu-btn" onclick="montrerSection('rendre')">
                    üì• Rendre
                </button>
                <button class="menu-btn" onclick="montrerSection('preter')">
                    üîÑ Pr√™ter B1‚ÜíB2
                </button>
                <button class="menu-btn" onclick="montrerSection('demander')">
                    üìû Demander ISBN
                </button>
                <button class="menu-btn" onclick="montrerSection('adherents')">
                    üë• Adh√©rents
                </button>
                <button class="menu-btn" onclick="montrerSection('supprimer')">
                    üóëÔ∏è Supprimer
                </button>
                <button class="menu-btn" onclick="retournerLivresPretes()">
                    ‚Ü©Ô∏è Retour Pr√™ts
                </button>
            </div>
        </div>

        <!-- Voir les Livres -->
        <div id="voir-livres" class="section">
            <h2 class="section-title">üìñ Catalogue des Livres</h2>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="afficherParType('tous')">Tous</button>
                <button class="tab-btn" onclick="afficherParType('Roman')">Romans</button>
                <button class="tab-btn" onclick="afficherParType('BD')">BD</button>
                <button class="tab-btn" onclick="afficherParType('Po√©sie')">Po√©sie</button>
                <button class="tab-btn" onclick="afficherParType('Th√©√¢tre')">Th√©√¢tre</button>
                <button class="tab-btn" onclick="afficherParType('Album')">Albums</button>
            </div>

            <div id="liste-livres" class="livre-grid"></div>
            <button class="btn btn-back" onclick="montrerSection('menu-principal')">‚Üê Retour</button>
        </div>

        <!-- Ajouter un Livre -->
        <div id="ajouter" class="section">
            <h2 class="section-title">‚ûï Ajouter un Nouveau Livre</h2>
            <div class="form-box">
                <form onsubmit="ajouterLivre(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Code :</label>
                            <input type="text" id="code" required placeholder="Ex: R001">
                        </div>
                        <div class="form-group">
                            <label>ISBN :</label>
                            <input type="text" id="isbn" required placeholder="Ex: ISBN-111">
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Titre :</label>
                        <input type="text" id="titre" required placeholder="Titre du livre">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Auteur :</label>
                            <input type="text" id="auteur" required placeholder="Nom de l'auteur">
                        </div>
                        <div class="form-group">
                            <label>√âditeur :</label>
                            <input type="text" id="editeur" required placeholder="Nom de l'√©diteur">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Type :</label>
                            <select id="type" required onchange="updateFormFields()">
                                <option value="Roman">Roman</option>
                                <option value="BD">Bande Dessin√©e</option>
                                <option value="Po√©sie">Recueil de Po√©sie</option>
                                <option value="Th√©√¢tre">Pi√®ce de Th√©√¢tre</option>
                                <option value="Album">Album</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Public Cible :</label>
                            <select id="publicCible" required>
                                <option value="Adulte">Adulte</option>
                                <option value="Ados">Adolescent</option>
                                <option value="Jeunesse">Jeunesse</option>
                                <option value="Tout public">Tout Public</option>
                            </select>
                        </div>
                    </div>

                    <div id="specificFields"></div>

                    <button type="submit" class="btn">Ajouter</button>
                    <button type="button" class="btn btn-back" onclick="montrerSection('menu-principal')">Annuler</button>
                </form>
            </div>
        </div>

        <!-- Emprunter -->
        <div id="emprunter" class="section">
            <h2 class="section-title">üì§ Emprunter un Livre</h2>
            <div class="form-box">
                <form onsubmit="emprunterLivre(event)">
                    <div class="form-group">
                        <label>Num√©ro Adh√©rent :</label>
                        <input type="text" id="numAdherentEmp" required placeholder="Ex: A001">
                    </div>
                    <div class="form-group">
                        <label>Code Livre :</label>
                        <input type="text" id="codeLivreEmp" required placeholder="Ex: R001">
                    </div>
                    <button type="submit" class="btn">Emprunter</button>
                    <button type="button" class="btn btn-back" onclick="montrerSection('menu-principal')">Annuler</button>
                </form>
            </div>
        </div>

        <!-- Rendre -->
        <div id="rendre" class="section">
            <h2 class="section-title">üì• Rendre un Livre</h2>
            <div class="form-box">
                <form onsubmit="rendreLivre(event)">
                    <div class="form-group">
                        <label>Num√©ro Adh√©rent :</label>
                        <input type="text" id="numAdherentRen" required placeholder="Ex: A001">
                    </div>
                    <div class="form-group">
                        <label>Code Livre :</label>
                        <input type="text" id="codeLivreRen" required placeholder="Ex: R001">
                    </div>
                    <button type="submit" class="btn">Rendre</button>
                    <button type="button" class="btn btn-back" onclick="montrerSection('menu-principal')">Annuler</button>
                </form>
            </div>
        </div>

        <!-- Pr√™ter -->
        <div id="preter" class="section">
            <h2 class="section-title">üîÑ Pr√™ter un Livre (B1 ‚Üí B2)</h2>
            <div class="form-box">
                <p style="margin-bottom: 15px; color: #7f8c8d;">
                    Transf√©rer un livre libre de la Biblioth√®que Centrale vers la Biblioth√®que Nord
                </p>
                <form onsubmit="preterLivre(event)">
                    <div class="form-group">
                        <label>Code Livre (dans B1) :</label>
                        <input type="text" id="codeLivrePret" required placeholder="Ex: T001">
                    </div>
                    <button type="submit" class="btn">Pr√™ter √† B2</button>
                    <button type="button" class="btn btn-back" onclick="montrerSection('menu-principal')">Annuler</button>
                </form>
            </div>
        </div>

        <!-- Demander par ISBN -->
        <div id="demander" class="section">
            <h2 class="section-title">üìû Demander un Livre par ISBN</h2>
            <div class="form-box">
                <p style="margin-bottom: 15px; color: #7f8c8d;">
                    B2 demande un livre √† B1 en utilisant son ISBN
                </p>
                <form onsubmit="demanderLivre(event)">
                    <div class="form-group">
                        <label>ISBN du Livre :</label>
                        <input type="text" id="isbnDemande" required placeholder="Ex: ISBN-555">
                    </div>
                    <button type="submit" class="btn">Demander √† B1</button>
                    <button type="button" class="btn btn-back" onclick="montrerSection('menu-principal')">Annuler</button>
                </form>
            </div>
        </div>

        <!-- Adh√©rents -->
        <div id="adherents" class="section">
            <h2 class="section-title">üë• Gestion des Adh√©rents</h2>
            
            <div class="form-box" style="margin-bottom: 20px;">
                <h3 style="margin-bottom: 15px;">‚ûï Inscrire un Nouvel Adh√©rent</h3>
                <form onsubmit="inscrireAdherent(event)">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Num√©ro :</label>
                            <input type="text" id="numAdh" required placeholder="Ex: A002">
                        </div>
                        <div class="form-group">
                            <label>Nom :</label>
                            <input type="text" id="nomAdh" required placeholder="Nom">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Pr√©nom :</label>
                            <input type="text" id="prenomAdh" required placeholder="Pr√©nom">
                        </div>
                        <div class="form-group">
                            <label>Adresse :</label>
                            <input type="text" id="adresseAdh" required placeholder="Ville">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Nombre de livres autoris√©s :</label>
                        <input type="number" id="nbLivresAdh" required value="2" min="1" max="10">
                    </div>
                    <button type="submit" class="btn">Inscrire</button>
                </form>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">Liste des Adh√©rents (B1)</h3>
            <table id="tableAdherents">
                <thead>
                    <tr>
                        <th>Num√©ro</th>
                        <th>Nom</th>
                        <th>Pr√©nom</th>
                        <th>Ville</th>
                        <th>Limite</th>
                        <th>Emprunt√©s</th>
                    </tr>
                </thead>
                <tbody id="listeAdherents"></tbody>
            </table>

            <button class="btn btn-back" style="margin-top: 20px;" onclick="montrerSection('menu-principal')">‚Üê Retour</button>
        </div>

        <!-- Supprimer -->
        <div id="supprimer" class="section">
            <h2 class="section-title">üóëÔ∏è Supprimer un Livre</h2>
            <div class="form-box">
                <form onsubmit="supprimerLivre(event)">
                    <div class="form-group">
                        <label>Code Livre :</label>
                        <input type="text" id="codeLivreSupp" required placeholder="Ex: P001">
                    </div>
                    <div class="form-group">
                        <label>Motif :</label>
                        <select id="motifSupp" required>
                            <option value="Perdu">Perdu</option>
                            <option value="Pilon">Pilon (mise au rebut)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-danger">Supprimer</button>
                    <button type="button" class="btn btn-back" onclick="montrerSection('menu-principal')">Annuler</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es
        let biblioSelectionnee = 1;
        let filtreType = 'tous';

        let bibliotheques = {
            1: {
                nom: "Biblioth√®que Centrale",
                ville: "Marseille",
                code: "B001",
                livres: [
                    { code: "R001", type: "Roman", titre: "Les Mis√©rables", auteur: "Victor Hugo", editeur: "Editeur1", isbn: "ISBN-111", public: "Adulte", etat: "Libre", genre: "Litt√©rature", emprunteur: null, proprietaire: 1 },
                    { code: "BD01", type: "BD", titre: "Ast√©rix", auteur: "Goscinny", editeur: "Editeur2", isbn: "ISBN-222", public: "Tout public", etat: "Libre", dessinateur: "Uderzo", emprunteur: null, proprietaire: 1 },
                    { code: "P001", type: "Po√©sie", titre: "Les Fleurs du Mal", auteur: "Baudelaire", editeur: "Editeur3", isbn: "ISBN-333", public: "Adulte", etat: "Libre", typePoesie: "Vers", emprunteur: null, proprietaire: 1 },
                    { code: "T001", type: "Th√©√¢tre", titre: "Tartuffe", auteur: "Moli√®re", editeur: "Editeur4", isbn: "ISBN-444", public: "Tout public", etat: "Libre", siecle: 17, emprunteur: null, proprietaire: 1 },
                    { code: "A001", type: "Album", titre: "Album Photos", auteur: "AuteurX", editeur: "Editeur5", isbn: "ISBN-555", public: "Jeunesse", etat: "Libre", illustrations: "Photos et dessins", emprunteur: null, proprietaire: 1 }
                ],
                adherents: [
                    { numero: "A001", nom: "Naimi", prenom: "Salima", adresse: "Marseille", nbLivresAutorise: 2, livresEmpruntes: [] }
                ]
            },
            2: {
                nom: "Biblioth√®que Nord",
                ville: "Aix-en-Provence",
                code: "B002",
                livres: [],
                adherents: []
            }
        };

        function selectionnerBiblio(num) {
            biblioSelectionnee = num;
            document.querySelectorAll('.biblio-card').forEach((card, i) => {
                card.classList.toggle('selected', i + 1 === num);
            });
            if (document.getElementById('voir-livres').classList.contains('active')) {
                afficherLivres();
            }
        }

        function montrerSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            if (id === 'voir-livres') {
                filtreType = 'tous';
                document.querySelectorAll('.tab-btn').forEach((btn, i) => {
                    btn.classList.toggle('active', i === 0);
                });
                afficherLivres();
            } else if (id === 'menu-principal') {
                mettreAJourStats();
            } else if (id === 'ajouter') {
                updateFormFields();
            } else if (id === 'adherents') {
                afficherAdherents();
            }
            cacherMessage();
        }

        function afficherParType(type) {
            filtreType = type;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.includes(type === 'tous' ? 'Tous' : type));
            });
            afficherLivres();
        }

        function afficherLivres() {
            const container = document.getElementById('liste-livres');
            const livres = bibliotheques[biblioSelectionnee].livres;
            
            const livresFiltres = filtreType === 'tous' 
                ? livres 
                : livres.filter(l => l.type === filtreType);

            if (livresFiltres.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Aucun livre dans cette cat√©gorie</p>';
                return;
            }

            container.innerHTML = livresFiltres.map(livre => {
                let details = '';
                if (livre.genre) details += `<div class="livre-info"><strong>Genre:</strong> ${livre.genre}</div>`;
                if (livre.dessinateur) details += `<div class="livre-info"><strong>Dessinateur:</strong> ${livre.dessinateur}</div>`;
                if (livre.typePoesie) details += `<div class="livre-info"><strong>Type:</strong> ${livre.typePoesie}</div>`;
                if (livre.siecle) details += `<div class="livre-info"><strong>Si√®cle:</strong> ${livre.siecle}e</div>`;
                if (livre.illustrations) details += `<div class="livre-info"><strong>Illustrations:</strong> ${livre.illustrations}</div>`;
                if (livre.emprunteur) details += `<div class="livre-info"><strong>Emprunt√© par:</strong> ${livre.emprunteur}</div>`;

                let badgeClass = livre.etat === 'Libre' ? 'libre' : (livre.etat === 'Emprunt√©' ? 'emprunte' : 'prete');
                
                return `
                    <div class="livre-card">
                        <h3>${livre.titre}</h3>
                        <div class="livre-info"><strong>Code:</strong> ${livre.code}</div>
                        <div class="livre-info"><strong>Auteur:</strong> ${livre.auteur}</div>
                        <div class="livre-info"><strong>ISBN:</strong> ${livre.isbn}</div>
                        <div class="livre-info"><strong>√âditeur:</strong> ${livre.editeur}</div>
                        <div class="livre-info"><strong>Public:</strong> ${livre.public}</div>
                        ${details}
                        <span class="badge ${badgeClass}">${livre.etat}</span>
                    </div>
                `;
            }).join('');
        }

        function updateFormFields() {
            const type = document.getElementById('type').value;
            const container = document.getElementById('specificFields');
            
            let html = '';
            if (type === 'Roman') {
                html = `
                    <div class="form-group">
                        <label>Genre :</label>
                        <select id="genre" required>
                            <option value="Litt√©rature">Litt√©rature</option>
                            <option value="Roman noir">Roman Noir</option>
                            <option value="Roman policier">Roman Policier</option>
                            <option value="Roman d'aventures">Roman d'Aventures</option>
                            <option value="Nouvelle">Nouvelle</option>
                            <option value="Roman historique">Roman Historique</option>
                        </select>
                    </div>
                `;
            } else if (type === 'BD') {
                html = `
                    <div class="form-group">
                        <label>Dessinateur :</label>
                        <input type="text" id="dessinateur" required placeholder="Nom du dessinateur">
                    </div>
                `;
            } else if (type === 'Po√©sie') {
                html = `
                    <div class="form-group">
                        <label>Type de Po√©sie :</label>
                        <select id="typePoesie" required>
                            <option value="Vers">Vers</option>
                            <option value="Prose">Prose</option>
                            <option value="Vers et Prose">Vers et Prose</option>
                        </select>
                    </div>
                `;
            } else if (type === 'Th√©√¢tre') {
                html = `
                    <div class="form-group">
                        <label>Si√®cle :</label>
                        <input type="number" id="siecle" required min="1" max="21" placeholder="Ex: 17">
                    </div>
                `;
            } else if (type === 'Album') {
                html = `
                    <div class="form-group">
                        <label>Type d'Illustrations :</label>
                        <select id="illustrations" required>
                            <option value="Photos">Photos</option>
                            <option value="Dessins">Dessins</option>
                            <option value="Photos et dessins">Photos et Dessins</option>
                        </select>
                    </div>
                `;
            }
            container.innerHTML = html;
        }

        function mettreAJourStats() {
            const totalLivres = bibliotheques[1].livres.length + bibliotheques[2].livres.length;
            const tousLivres = [...bibliotheques[1].livres, ...bibliotheques[2].livres];
            const libres = tousLivres.filter(l => l.etat === 'Libre').length;
            const empruntes = tousLivres.filter(l => l.etat === 'Emprunt√©').length;
            const pretes = tousLivres.filter(l => l.etat === 'Pr√™t√©').length;
            const adherents = bibliotheques[1].adherents.length + bibliotheques[2].adherents.length;

            document.getElementById('totalLivres').textContent = totalLivres;
            document.getElementById('livresLibres').textContent = libres;
            document.getElementById('livresEmpruntes').textContent = empruntes;
            document.getElementById('livresPretes').textContent = pretes;
            document.getElementById('totalAdherents').textContent = adherents;
            document.getElementById('livres-b1').textContent = bibliotheques[1].livres.length;
            document.getElementById('livres-b2').textContent = bibliotheques[2].livres.length;
        }

        function afficherMessage(texte, type) {
            const msg = document.getElementById('message');
            msg.textContent = texte;
            msg.className = `message ${type} show`;
            setTimeout(() => msg.classList.remove('show'), 4000);
        }

        function cacherMessage() {
            document.getElementById('message').classList.remove('show');
        }

        function ajouterLivre(e) {
            e.preventDefault();
            
            const livre = {
                code: document.getElementById('code').value.toUpperCase(),
                type: document.getElementById('type').value,
                titre: document.getElementById('titre').value,
                auteur: document.getElementById('auteur').value,
                editeur: document.getElementById('editeur').value,
                isbn: document.getElementById('isbn').value.toUpperCase(),
                public: document.getElementById('publicCible').value,
                etat: 'Libre',
                emprunteur: null,
                proprietaire: biblioSelectionnee
            };

            // V√©rifier code unique
            const tousLivres = [...bibliotheques[1].livres, ...bibliotheques[2].livres];
            if (tousLivres.find(l => l.code === livre.code)) {
                afficherMessage('‚ùå Ce code existe d√©j√† !', 'error');
                return;
            }

            // Champs sp√©cifiques
            if (livre.type === 'Roman') {
                livre.genre = document.getElementById('genre').value;
            } else if (livre.type === 'BD') {
                livre.dessinateur = document.getElementById('dessinateur').value;
            } else if (livre.type === 'Po√©sie') {
                livre.typePoesie = document.getElementById('typePoesie').value;
            } else if (livre.type === 'Th√©√¢tre') {
                livre.siecle = parseInt(document.getElementById('siecle').value);
            } else if (livre.type === 'Album') {
                livre.illustrations = document.getElementById('illustrations').value;
            }

            bibliotheques[biblioSelectionnee].livres.push(livre);
            afficherMessage('‚úÖ Livre ajout√© avec succ√®s !', 'success');
            e.target.reset();
            updateFormFields();
            mettreAJourStats();
            
            setTimeout(() => montrerSection('menu-principal'), 1500);
        }

        function emprunterLivre(e) {
            e.preventDefault();
            
            const numAdh = document.getElementById('numAdherentEmp').value.toUpperCase();
            const code = document.getElementById('codeLivreEmp').value.toUpperCase();
            
            const adherent = bibliotheques[biblioSelectionnee].adherents.find(a => a.numero === numAdh);
            if (!adherent) {
                afficherMessage('‚ùå Adh√©rent non trouv√© dans cette biblioth√®que', 'error');
                return;
            }

            const livre = bibliotheques[biblioSelectionnee].livres.find(l => l.code === code);
            if (!livre) {
                afficherMessage('‚ùå Livre non trouv√©', 'error');
                return;
            }

            if (livre.etat !== 'Libre') {
                afficherMessage('‚ùå Livre non disponible', 'error');
                return;
            }

            if (adherent.livresEmpruntes.length >= adherent.nbLivresAutorise) {
                afficherMessage('‚ùå Limite d\'emprunts atteinte', 'error');
                return;
            }

            livre.etat = 'Emprunt√©';
            livre.emprunteur = `${adherent.prenom} ${adherent.nom}`;
            adherent.livresEmpruntes.push(code);

            afficherMessage(`‚úÖ Livre emprunt√© par ${adherent.prenom} ${adherent.nom}`, 'success');
            e.target.reset();
            mettreAJourStats();
            
            setTimeout(() => montrerSection('menu-principal'), 1500);
        }

        function rendreLivre(e) {
            e.preventDefault();
            
            const numAdh = document.getElementById('numAdherentRen').value.toUpperCase();
            const code = document.getElementById('codeLivreRen').value.toUpperCase();
            
            const adherent = bibliotheques[biblioSelectionnee].adherents.find(a => a.numero === numAdh);
            if (!adherent) {
                afficherMessage('‚ùå Adh√©rent non trouv√©', 'error');
                return;
            }

            const livre = bibliotheques[biblioSelectionnee].livres.find(l => l.code === code);
            if (!livre) {
                afficherMessage('‚ùå Livre non trouv√©', 'error');
                return;
            }

            if (livre.etat !== 'Emprunt√©') {
                afficherMessage('‚ùå Ce livre n\'est pas emprunt√©', 'error');
                return;
            }

            if (!adherent.livresEmpruntes.includes(code)) {
                afficherMessage('‚ùå Ce livre n\'a pas √©t√© emprunt√© par cet adh√©rent', 'error');
                return;
            }

            // Retour √† l'√©tat appropri√©
            if (livre.proprietaire !== biblioSelectionnee) {
                livre.etat = 'Pr√™t√©';
            } else {
                livre.etat = 'Libre';
            }
            
            livre.emprunteur = null;
            adherent.livresEmpruntes = adherent.livresEmpruntes.filter(c => c !== code);

            afficherMessage(`‚úÖ Livre rendu par ${adherent.prenom} ${adherent.nom}`, 'success');
            e.target.reset();
            mettreAJourStats();
            
            setTimeout(() => montrerSection('menu-principal'), 1500);
        }

        function preterLivre(e) {
            e.preventDefault();
            
            const code = document.getElementById('codeLivrePret').value.toUpperCase();
            const index = bibliotheques[1].livres.findIndex(l => l.code === code);
            
            if (index === -1) {
                afficherMessage('‚ùå Livre non trouv√© dans B1', 'error');
                return;
            }

            const livre = bibliotheques[1].livres[index];
            
            if (livre.etat !== 'Libre') {
                afficherMessage('‚ùå Livre non disponible pour le pr√™t', 'error');
                return;
            }

            // Transf√©rer le livre
            bibliotheques[1].livres.splice(index, 1);
            livre.etat = 'Pr√™t√©';
            bibliotheques[2].livres.push(livre);

            afficherMessage('‚úÖ Livre pr√™t√© √† B2 avec succ√®s !', 'success');
            e.target.reset();
            mettreAJourStats();
            
            setTimeout(() => montrerSection('menu-principal'), 1500);
        }

        function demanderLivre(e) {
            e.preventDefault();
            
            const isbn = document.getElementById('isbnDemande').value.toUpperCase();
            const index = bibliotheques[1].livres.findIndex(l => l.isbn === isbn);
            
            if (index === -1) {
                afficherMessage('‚ùå Livre avec cet ISBN non trouv√© dans B1', 'error');
                return;
            }

            const livre = bibliotheques[1].livres[index];
            
            if (livre.etat !== 'Libre') {
                afficherMessage('‚ùå Livre non disponible', 'error');
                return;
            }

            // Transf√©rer le livre
            bibliotheques[1].livres.splice(index, 1);
            livre.etat = 'Pr√™t√©';
            bibliotheques[2].livres.push(livre);

            afficherMessage('‚úÖ Livre demand√© et transf√©r√© √† B2 !', 'success');
            e.target.reset();
            mettreAJourStats();
            
            setTimeout(() => montrerSection('menu-principal'), 1500);
        }

        function supprimerLivre(e) {
            e.preventDefault();
            
            const code = document.getElementById('codeLivreSupp').value.toUpperCase();
            const motif = document.getElementById('motifSupp').value;
            const index = bibliotheques[biblioSelectionnee].livres.findIndex(l => l.code === code);
            
            if (index === -1) {
                afficherMessage('‚ùå Livre non trouv√©', 'error');
                return;
            }

            const livre = bibliotheques[biblioSelectionnee].livres[index];
            
            if (livre.etat === 'Emprunt√©') {
                afficherMessage('‚ùå Impossible de supprimer un livre emprunt√©', 'error');
                return;
            }

            bibliotheques[biblioSelectionnee].livres.splice(index, 1);
            afficherMessage(`‚úÖ Livre supprim√© (${motif})`, 'success');
            e.target.reset();
            mettreAJourStats();
            
            setTimeout(() => montrerSection('menu-principal'), 1500);
        }

        function inscrireAdherent(e) {
            e.preventDefault();
            
            const adherent = {
                numero: document.getElementById('numAdh').value.toUpperCase(),
                nom: document.getElementById('nomAdh').value,
                prenom: document.getElementById('prenomAdh').value,
                adresse: document.getElementById('adresseAdh').value,
                nbLivresAutorise: parseInt(document.getElementById('nbLivresAdh').value),
                livresEmpruntes: []
            };

            // V√©rifier si existe d√©j√†
            if (bibliotheques[1].adherents.find(a => a.numero === adherent.numero)) {
                afficherMessage('‚ùå Ce num√©ro d\'adh√©rent existe d√©j√†', 'error');
                return;
            }

            bibliotheques[1].adherents.push(adherent);
            afficherMessage('‚úÖ Adh√©rent inscrit avec succ√®s !', 'success');
            e.target.reset();
            afficherAdherents();
            mettreAJourStats();
        }

        function afficherAdherents() {
            const tbody = document.getElementById('listeAdherents');
            const adherents = bibliotheques[1].adherents;
            
            tbody.innerHTML = adherents.map(a => `
                <tr>
                    <td>${a.numero}</td>
                    <td>${a.nom}</td>
                    <td>${a.prenom}</td>
                    <td>${a.adresse}</td>
                    <td>${a.nbLivresAutorise}</td>
                    <td>${a.livresEmpruntes.length}</td>
                </tr>
            `).join('');
        }

        function retournerLivresPretes() {
            let compteur = 0;
            
            // Parcourir les livres de B2
            const livresARetourner = [];
            bibliotheques[2].livres.forEach((livre, index) => {
                if (livre.etat === 'Pr√™t√©' && livre.emprunteur === null && livre.proprietaire === 1) {
                    livresARetourner.push(index);
                }
            });

            // Retourner les livres √† B1
            livresARetourner.reverse().forEach(index => {
                const livre = bibliotheques[2].livres[index];
                bibliotheques[2].livres.splice(index, 1);
                livre.etat = 'Libre';
                bibliotheques[1].livres.push(livre);
                compteur++;
            });

            if (compteur > 0) {
                afficherMessage(`‚úÖ ${compteur} livre(s) rendu(s) √† B1`, 'success');
            } else {
                afficherMessage('‚ÑπÔ∏è Aucun livre √† retourner', 'success');
            }
            
            mettreAJourStats();
        }

        // Initialisation
        updateFormFields();
        mettreAJourStats();
        afficherAdherents();
    </script>
</body>
</html>